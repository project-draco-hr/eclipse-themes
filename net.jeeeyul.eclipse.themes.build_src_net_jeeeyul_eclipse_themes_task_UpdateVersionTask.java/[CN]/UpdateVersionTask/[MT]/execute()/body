{
  try {
    ArrayList<Manifest> manifests=new ArrayList<Manifest>();
    ArrayList<IProject> projects=getProjects();
    ArrayList<String> bundleIdList=new ArrayList<String>();
    for (    IProject eachProject : projects) {
      IFile manifestFile=eachProject.getFile(new Path("META-INF/MANIFEST.MF"));
      Manifest m=new Manifest(manifestFile);
      manifests.add(m);
      bundleIdList.add(m.getBundleId());
    }
    for (    Manifest m : manifests) {
      System.out.println(MessageFormat.format("Updating version:{0} {1}.qualifier",m.getBundleId(),this.version));
      m.setBundleVersion(this.version + ".qualifier");
      m.updateDependencies(bundleIdList,this.version);
      m.save();
    }
    System.out.println("Update versions in feature project...");
    IFile featureFile=getFeatureProject().getFile("feature.xml");
    String featureContent=read(featureFile.getContents(),featureFile.getCharset());
    String newcontent=featureContent.replaceAll("version=\"[0-9]+\\.[0-9]+\\.[0-9]+\\.qualifier\"",MessageFormat.format("version=\"{0}.qualifier\"",this.version));
    write(featureFile,newcontent,featureFile.getCharset());
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw new BuildException(e);
  }
}
